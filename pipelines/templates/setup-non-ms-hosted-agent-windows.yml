# Windows version of set-up a clean virtual machine for pipeline.

steps:

# Install azcopy for cache download.

- powershell: |
    New-Item -ItemType Directory -Force -Path $(Agent.ToolsDirectory)\azcopy
    Invoke-WebRequest -Uri "https://aka.ms/downloadazcopy-v10-windows" -OutFile "$(Agent.ToolsDirectory)\azcopy\azcopy.zip"
    Expand-Archive "$(Agent.ToolsDirectory)\azcopy\azcopy.zip" -DestinationPath "$(Agent.ToolsDirectory)\azcopy"
    Copy-Item "$(Agent.ToolsDirectory)\azcopy\azcopy*\*" -Destination "$(Agent.ToolsDirectory)\azcopy"
    Get-ChildItem "$(Agent.ToolsDirectory)\azcopy"
    Write-Host "##vso[task.prependpath]$(Agent.ToolsDirectory)\azcopy"
  displayName: Setup azcopy


# UsePythonVersion task only works when the specific Python version is already installed.

# The following is for linux.
# Reference: https://stackoverflow.com/questions/60936103/install-python-to-self-hosted-windows-build-agent
# We only need Python 3.9 on Windows.

- powershell: |
    Invoke-WebRequest -Uri "https://www.python.org/ftp/python/3.9.12/python-3.9.12-amd64.exe" -OutFile "python-3.9.exe"
    .\python-3.9.exe /quiet TargetDir=$(Agent.ToolsDirectory)\Python\3.9.12\x64 Include_launcher=0
    New-Item $(Agent.ToolsDirectory)\Python\3.9.12\x64.complete -type file
  displayName: Install Python 3.9
