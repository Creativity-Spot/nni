steps:

# OS from VMSS is very clean... Need to install basic utilities.

# UsePythonVersion task only works when the specific Python version is already installed.

# The following is for linux.
# Reference: https://dev.to/akaszynski/create-an-azure-self-hosted-agent-without-going-insane-173g
# We only need Python 3.7 and 3.9 for now.
- script: |
    set -e
    sudo add-apt-repository ppa:deadsnakes/ppa
    sudo apt install -y python3.7-dev python3.7-venv python3.9-dev python3.9-venv
    mkdir $(Agent.ToolsDirectory)/Python
  displayName: Download Python

- script: |
    set -e
    cd $(Agent.ToolsDirectory)/Python
    PY39_VER=$(python3.9 -c "import sys; print('.'.join([f'{val}' for val in sys.version_info[:3]]))")
    mkdir $PY39_VER
    ln -s $PY39_VER 3.9
    cd $PY39_VER
    python3.9 -m venv x64
    touch x64.complete
  displayName: Configure Python 3.9

- script: |
    set -e
    cd $(Agent.ToolsDirectory)/Python
    PY37_VER=$(python3.7 -c "import sys; print('.'.join([f'{val}' for val in sys.version_info[:3]]))")
    mkdir $PY37_VER
    ln -s $PY37_VER 3.7
    cd $PY37_VER
    python3.7 -m venv x64
    touch x64.complete
  displayName: Configure Python 3.7
